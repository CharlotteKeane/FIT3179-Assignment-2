{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#cce5ff",      
  "params": [
    {
      "name": "ClickAge",
      "select": {"type": "point", "fields": ["Age"], "on": "click", "clear": "dblclick"}
    },
    {
      "name": "SexSelection",
      "value": "All",
      "bind": {"input": "select", "options": ["All", "Male", "Female"], "name": "Select Sex: "}
    }
  ],
  "vconcat": [
    {
      "title": "Proportion Meeting Physical Activity Guidelines by Age Group",
      "width": 1000,
      "height": 250,
      "data": {"url": "Males.csv"},
      "transform": [{"fold": ["Met (%)", "Did not meet (%)"], "as": ["Status", "Value"]}],
      "mark": "bar",
      "encoding": {
        "x": {"field": "Age", "type": "ordinal", "title": "Age Group"},
        "y": {"field": "Value", "type": "quantitative", "title": "Percentage"},
        "color": {
          "field": "Status",
          "type": "nominal",
          "scale": {"domain": ["Met (%)", "Did not meet (%)"], "range": ["#1f77b4", "#ff7f0e"]},
          "title": "Physical Activity Status"
        },
        "tooltip": [
          {"field": "Age", "type": "ordinal"},
          {"field": "Status", "type": "nominal"},
          {"field": "Value", "type": "quantitative", "format": ".1f"}
        ]
      }
    },
    {
      "title": "Australia Participants by State, Age, and Sex",
      "width": 1000,
      "height": 600,
      "projection": {"type": "mercator"},
      "layer": [
        {
          "data": {"url": "Australia.topojson.json", "format": {"type": "topojson", "feature": "austates"}},
          "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"}
        },
        {
          "data": {"url": "Males.csv", "format": {"type": "csv"}},
          "transform": [
            {
              "filter": "(SexSelection == 'All' || trim(toString(datum.Sex)) == trim(toString(SexSelection))) && (ClickAge == null || datum.Age == ClickAge.Age)"
            }
          ],
          "mark": {"type": "circle", "stroke": "white", "opacity": 0.8, "strokeWidth": 0.7},
          "encoding": {
            "longitude": {"field": "Lon", "type": "quantitative"},
            "latitude": {"field": "Lat", "type": "quantitative"},
            "size": {
              "field": "ParticipationRate",
              "type": "quantitative",
              "title": "Participation Rate",
              "scale": {"range": [100, 2500]}
            },
            "color": {
              "field": "Sex",
              "type": "nominal",
              "title": "Sex",
              "scale": {"domain": ["Male", "Female"], "range": ["#1f77b4", "#ff69b4"]}
            },
            "tooltip": [
              {"field": "State", "type": "nominal"},
              {"field": "Age", "type": "nominal"},
              {"field": "Sex", "type": "nominal"},
              {"field": "ParticipationRate", "type": "quantitative", "title": "Participation Rate"}
            ]
          }
        }
      ]
    }
  ]
}
